# **DRDoS**

<br>

### `DRDoS(Distributed Reflection DoS)`란 DDoS의 진화된 형태로 **먼저 공격자가 IP를 공격 대상으로 Spoofing**한다.(IP 속임)
### 그 후, 대량의 공격 요청을 반사 대상(서버)에게 보내면, 대량의 요청을 받은 반사 대상은 요청의 출발지에게 응답을 한다.

<br><br>

- - -
<br>

## **공격과정**

<br>

### 1. 공격자는 출발지 IP를 공격대상 IP로 변조(Spoofing)한 후 취약한 서버들에 패킷의 크기를 증폭 시키는 요청을 한다.
### 2. 출발지 IP가 공격대상 IP로 변조되었으므로, 증폭 된 패킷이 공격대상 IP로 전달된다.
### 결국, 공격 대상은 수많은 서버로부터 **증폭된 응답 패킷**을 받게된다.

<br>

![](https://velog.velcdn.com/images/younghyun/post/4a30b061-2af8-4686-969c-802bddfd853b/image.png)

<br><br>

- - -

<br>

## **DRDoS의 특징**

<br>

### **트래픽을 증폭시킬 수 있다.**  
<br>

#### 반사체의 응답 크기가 1500바이트를 넘을 경우 `MTU (Maximum Transmission Unit)`에 의해 1500바이트 단위로 데이터를 분할(Packet Flagmentation)하는데, 분할된 데이터들은 개별적인 패킷으로 전송된다.
#### 예를 들어, DNS 증폭의 경우 최대 4,096바이트의 응답을 만들 수 있으므로 1500+1500+1096바이트로 최대 3개의 패킷을 만들 수 있다.  

#### 또한, 반사체나 프로토콜의 고유의 특성으로 여러개의 패킷을 전송하는 경우가 있는데, NTP 증폭은 응답 본체 패킷 1개 + 데이터 패킷 100개로 최대 101개의 패킷을 만들 수 있다.

<br>

### **추적이 힘들다**

<br>

#### DRDoS의 경우, 먼저 공격 주체가 공격자 본인이 아니고, 반사체이다. 그리고, 공격자가 보내는 패킷 또한 IP Spoofing이 되어 있고, 반사체 또한 어떠한 정보도 가지고 있지 않아서 공격 매체를 수색해도 찾아낼 수 없다.
#### 그리고, 반사체가 같은 나라에만 있는 것이 아닌, 해외에도 있기 때문에 물리적 수사 또한 힘들다.
#### 이런 특징때문에 DRDoS 트래픽은 실제 공격 근원지를 찾아내기가 매우 힘들다. 또한, DRDoS도 좀비를 이용할 수 있다.

<br><br>

- - -

<br>

## **DRDoS의 종류**

<br>

### **3-way handshake**
#### 반사체가 대량의 `syn/ack` 응답을 보내 시스템을 다운시키는 공격

<br>

### **ICMP DRDoS**
#### ICMP 프로토콜의 `echo/request`를 이용한 대량의 트래픽 증폭 공격


<br>

### **UDP 서비스 제공 서버**
#### UDP 서비스 제공 서버를 이용하여 대량의 트래픽을 유발하는 공격

<br>


### **DNS DRDoS**
#### DNS 질의 때 많은 양의 레코드 타입을 요청하여 대량의 트래픽을 유발시키는 공격

<br>

### **NTP DRDoS**
#### 최근 접속한 NTP 서버목록(monlist)를 요청하여 대량의 응답 트래픽을 유발시키는 공격

<br>

### **SNMP DRDoS**
#### `SNMP agent`에 대량의 `MIB`를 요청하여 트래픽을 유발시키는 공격

<br>

### **CHARGEN DRDoS**
#### CHARGEN 서버에 접속 시 대량의 문자열을 전송하여 트래픽을 유발시키는 공격

<br>

### **Memcached Server**
#### `Memcached Server`에 공격대상 IP 주소로 위장된 특정 명령의 UDP 패킷을 전송함.
#### `Memcached Server`가 공격 대상 IP로 원래 패킷보다 수배에 달하는 패킷을 반사함.

<br><br>


- - -

<br>

## **DRDoS의 조건**

<br>

### **1. 공격자 정하기**

<br>

### **2. IP Spoofing**
#### IP Spoofing를 방지한 환경이 많다. IP Spoofing이 막힐 시, DRDoS는 불가능하다.

<br>

### **3. 우수한 반사체 확보**

#### 반사체에게 보내는 요청도, 반세체에 대한 공격이 될 수 있다. 요쳥량이 너무 많을 시 반사체가 견디기 어려울 수 있다.
#### 반사체가 다운되면 공격량이 크게 떨어지는데, 이걸 방지하기 위해 여러 반사체가 필요하다.

<br>

### **4. 공격 파라미터의 유지보수**

#### 반사체는 언제든지 생기거나 사라질 수 있고, 증폭이 되다가 안 될 수도 있다. 이런 변수를 막고, 증폭률을 일정하게 관리해야 한다.

<br>

### **5. 성능 확보**

#### 반사체에게 보내는 요청 패킷은 크기가 100바이트가 되지 않는 작은 크기가 대부분인데, 크기가 워낙 작기에 네트워크 대역을 다 사용하지 못하거나, CPU 사용율이 올라가는 등 효율이 크게 감소할 수 있다.
<br>

### **6. 공격 밀도**

#### DRDoS의 공격 대상이 버티는 경우가 있다. 
#### 보통, DDoS보다 에이전트 자체의 수가 적고 반사체의 응답성에 따라 패킷의 밀도가 들쭉날쭉하기 때문이거나, 네트워크 성능에 의해 초당 패킷 갯수 제한이나 소프트웨어 문제로 패킷의 일부가 유실되는게 원인이다.

<br>

### **손실**

<br>

#### DRDoS는 같은 규모의 공격을 하더라도 더 적은 반사 공격 트래픽에 의존하기 때문에 약간의 손실도 공격 규모의 큰 감소를 가져오게 된다. 손실을 줄일 수 있는 설계가 반드시 필요하다.

<br><br>

- - -

<br>

## **대응책**

<br>

### **Ingress Filtering**

###     ISP에서 위조 패킷이 망에 인입되지 않도록 직접 차단한다.

<br>

### **ICMP Protocol 차단**



###     ICMP 악용 방지를 위해, 사용하지 않을 시 해당 프로토콜을 차단한다.