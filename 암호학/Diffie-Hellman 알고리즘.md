# **Diffie-Hellman 알고리즘**

<br>

* ### 대칭키 암호는 임의의 데이터를 안전하게 암호화할 수 있지만, 이를 이용하여 수신자와 송신자가 데이터를 주고 받으려면 수신자와 송신자가 같은 키를 공유하고 있다는 전제가 필요함.

* ### 다시 말해, 두 사람이 대칭키 암호 시스템을 사용하여 통신하려면 데이터를 교환하기 전에 키 교환(Key Exchange)가 필요함.

* ### 이 과정에서 도청당하는 등, 안전하게 공유할 수 없는 환경에서는 대칭키 암호는 무용지물임.

* ### 그래서 암호학자들은 네트워크같은 공개된 채널을 통해 키를 교환해도 외부인은 키를 알 수 없게 하는 공개 키 교환 알고리즘을 고안했는데, Diffie-Helman 키 교환 알고리즘은 최초의 공개 키 교환 알고리즘임.

<br>

- - -

<br>

## **수학적 원리**

<br>

* ### 1976년 Whitfield Diffie와 Martin Hellman은 공개된 채널로 키를 교환할 수 있는 Diffie-Hellman 키 교환 절차를 만들어 냄
* ### 이를 이해하기 위해선 모듈로 연산에서의 거듭제곱, 페르마의 소정리, 이산 로그 등 수학적 배경지식이 필요함.

<br><br>

- - -

<br>

## **키 교환 절차**

<br>

* ### 키를 교환하고자 하는 Alice는 소수 p와 1<=g <= p -1을 만족하는 적당한 수 g를 정해 bob에게로 전송함. p는 보통 2의 1024제곱 이상의 큰 소수로 설정함.

* ### 다시 Alice는 1<=a<=p-1을 만족하는 적당한 수 a를 정하여 A = g의 a제곱 % p를 bob에게 전송함.

* ### Alice로부터 g와 p를 받은 Bob은 1<=b<=p-1을 만족하는 적당한 수 b를 정해 B = g의 b제곱 % p를 Alice에게 전송함.

* ### Alice는 bob이 보낸 B를 a제곱하고, bob은 alice가 보낸 a를 b제곱하는데, 이렇게 될 시 둘이 같은 값이 K가 나오게 됨.

<br>

![이미지](https://kr.object.ncloudstorage.com/dreamhack-content/page/bda133b09c1cfc34300879678384e4daa639f916dcaf08a91bb404ebdb25b51a.jpg)

<br>
<br>

- - -

<br>

## Diffie-Hellman에 대한 중간자 공격

<br>

* ### 네트워크로 통신하는 두 주체는 서로의 신원을 확인하기 어려운데, 중간자 공격(Man In The Middle Attack, MITM)은 네트워크의 이런 특성을 이용한 공격임.

* ### 일반적으로 네트워크에서 발생하는 공격은 공격자가 통신에 개입하지 않으면 수동적 공격, 개입하면 능동적 공격으로 구분하는데 중간자 공격은 능동적 공격에 속함.

* ### Diffie-Hellman 키 교환 알고리즘은 Alice와 bob이 통신할 때 공격자가 자신을 bob이라고, bob에게는 자신이 alice라고 속이면 alice와 bob은 누가 신뢰하는 상대인지 공격자인지 모름.

* ### alice가 bob에게 키 교환을 시도하면 공격자가 이를 가로채어 둘 모두와 키 교환을 진행하고, 그 결과로 alice와 bob에게 각자 키를 공유함. 공격자에게 속은 alice는 bob과 서로 키가 공유됐다고 생각함.

* ### 이후 alice가 bob에게 받은 키로 암호화된 데이터를 전송하면 공격자는 이를 복호화한 후 bob에게 준 키로 암호화하여 bob에게 보냄. 그리고 bob이 응답 시 똑같은 방법으로 alice에게 재전송함.

* ### 이 과정에서 공격자는 둘 사이에 오가는 정보를 모두 알 수 있고, 변조 또한 가능함.

* ### 이런 취약점으로 인해, Diffie-Hellman 키 교환 알고리즘은 서로의 신원을 확인할 수 있는 추가적인 메커니즘이 동반되어야 함.