# **x86-64 아키텍처**

<br>

### **x64 아키텍처**는 인텔의 32비트 CPU 아키텍처인 `IA-32`를 **64**비트 환경에서 사용하도록 확장한 아키텍처로, **대다수의 개인용 컴퓨터들이 인텔의 x64 CPU를 사용**한다.

<br>

> ## **32비트, 64비트**
> ### 여기서 32비트, 64비트의 숫자는 **CPU가 한번에 처리할 수 있는 데이터의 크기**이다.
> ### 컴퓨터과학에서는, 이를 **CPU가 이해할 수 있는 데이터의 단위**라는 의미에서 **`WORD`** 라고 부른다.
> ### `WORD`의 크기는 CPU의 설계에 따라 달라지며, 레지스터의 용량이나 버스들의 대역폭들이 모드 `WORD`만큼 정해져있다.
> ### 현대의 PC는 거의 64비트를 사용하는데, 그 이유는 32비트 아키텍처가 제공할 수 있는 **가상메모리(CPU가 프로세스에게 제공하는 가상의 메모리 공간)의 크기가 작기 떄문**이다.
> ### 32비트 아키텍처에선, 최대 4기가바이트(4,294,967,296바이트)이지만, 64비트 아키텍처에선 이론상 16엑사 바이트(16,777,216 테라바이트)까지 제공되므로 메모리 자원이 부족해서 소프트웨어의 성능이 떨어지는 일은 거의 발생하지 않는다.
<br>

<br><br><br>

- - -
<br>

## **x86-64 아키텍처 : 레지스터**

<br>

### 레지스터는 **CPU**가 데이터를 빠르게 저장,사용할 때 이용하는 보관소로, 다양한 용도로 사용되는데 x64 아키텍처에서는 **[범용 레지스터(General Register)](#범용-레지스터)**,**[세그먼트 레지스터(Segment Register)](#세그먼트-레지스터)**, **[명령어 포인터 레지스터(Instruction Poinster Register, IP)](#명령어-포인터-레지스터)**,**[플래그 레지스터(Flag Register)](#플래그-레지스터)** 가 있다.

<br>

## 범용 레지스터
<br>

### 범용 레지스터는 **주용도는 있으나, 그 외의 다양한 용도로도 사용이 가능**한 레지스터이다.
### x86-64에서 각각의 범용 레지스터는 8바이트를 저장할 수 있으며 부호 없는 정수를 2^64 - 1까지의 수를 나타낼 수 있다. 자주 쓰이는 범용 레지스터의 주용도는 아래와 같다.

<br>

|**이름**|**주용도**|
|:---:|:---:|
|**rax (accumulator register)**|함수의 반환 값|
|**rbx (base register)**|x64에서는 주된 용도 없음|
|**rcs(counter register)**|반복문의 반복 횟수, 각종 연산의 시행 횟수|
|**rdx (data register)**|x64에서는 주된 용도 없음|
|**rsi (source index)**|데이터를 옮길 떄 원본을 가리키는 포인터|
|**rdi (destination index)** | 데이터를 옮길 때 목적지를 가리키는 포인터|
|**rsp (stack pointer)** | 사용중인 스택의 위치를 가리키는 포인터|
|**rbp (stack base pointer)**| 스택의 바닥을 가리키는 포인터|

<br><br>

## 세그먼트 레지스터
<br>

### x64 아키텍처에는 `cs`,`ss`,`ds`,`es`,`fs`,`gs` 총 6가지가 있으며 각자의 크기는 16비트이다. 세그먼트 레지스터는 x64로 아키텍처가 확장되면서 용도에 큰 변화가 생긴 레지스터이다.
### 현대의 x64에서는 `cs`는 코드 영역, `ds`는 데이터, `ss`는 스택 메모리 영역을 가리킬 때 사용하고, 나머지 레지스터는 운영쳐제 별로 용도를 결정할 수 있는 범용적인 레지스터이다.

<br><br>

## 명령어 포인터 레지스터

<br>

### 프로그램은 일련의 기계어 코드들로 이루어져 있는데, 이 중에서 CPU가 어느 부분의 코드를 실행할지 가리키는게 **`명령어 포인터 레지스터(Instruction Poinster Register, IP)`** 의 역할이다.
### x64 아키텍처의 명령어 레지스터는 **`rip`** 이며, 크기는 8바이트이다.

<br><br>

## 플래그 레지스터

<br>

### 플래그 레지스터는 **프로세서의 현재 상태를 저장**하고 있는 레지스터이다.
### **깃발을 올리고, 내리는 행위로 신호를 전달**하듯, 플래그 레지스터는 자신을 구성하는 여러 비트들로 CPU의 현재 상태를 표현한다.
### 주로 사용되는 플래그는 아래와 같다.

<br>

|**플래그**|**의미**|
|:---:|:---:|
|**CF (Carry Flag)** | 부호 없는 수의 연산 결과가 비트의 범위를 넘을 경우 설정된다.|
|**ZF (Zero Flag)**|연산의 결과가 0일 경우 설정된다.|
|**SF (Sign Flag)**|연산의 결과가 음수일 경우 설정된다.|
|**OF (Overflow Flag)**|부호 있는 수의 연산 결과가 비트 범위를 넘을 경우 설정된다.|

<br><br><br>

- - -
## **레지스터 호환**

<br>

### x86-64 아키텍처는 `IA-32`의 64비트 확장 아키텍처이며, 호환이 가능하다.
### `IA-32`의 CPU는 32비트의 크기를 가지고, 별칭은 rax, rbx...대신 eax,ebx... 처럼 붙는다.
### r레지스터들(64비트)은 e레지스터들(32비트)의 확장된 형태로, e레지스터들(32비트)은 확장된 레지스터의 하위 32비트를 가리킨다.
### 마찬가지로, e레지스터들(32비트)은 과거 16비트 아키텍처 `IA-16`과의 호환을 위해, 별칭이 안붙은 레지스터들(16비트)은 e레지스터들의 하위 16비트를 가리킨다.
### 이들 중, 몇몇은 다시 상위 8비트, 하위 8비트로 나뉘는데 이들에 대한 내용은 아래 그림과 같다.

![](https://velog.velcdn.com/images/younghyun/post/501a6c50-edd7-4dca-bb65-05cf319802aa/image.png)